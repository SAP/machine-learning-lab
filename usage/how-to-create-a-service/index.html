



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for the Machine Learning Lab">
      
      
        <link rel="canonical" href="https://github.wdf.sap.corp/pages/sap/machine-learning-lab/usage/how-to-create-a-service/">
      
      
        <meta name="author" content="Lukas Masuch & Benjamin Räthlein">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-4.6.3">
    
    
      
        <title>How to create a Service - Machine Learning Lab</title>
      
    
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.adb8469c.css">
      
      
    
    <link rel="stylesheet" href="../../css/image-slider.css">

    
    
      <script src="../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../css/mllab.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#how-to-create-a-service" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://github.wdf.sap.corp/pages/sap/machine-learning-lab/" title="Machine Learning Lab" aria-label="Machine Learning Lab" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Machine Learning Lab
            </span>
            <span class="md-header-nav__topic">
              
                How to create a Service
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.wdf.sap.corp/sap/machine-learning-lab" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    sap/machine-learning-lab
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://github.wdf.sap.corp/pages/sap/machine-learning-lab/" title="Machine Learning Lab" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Machine Learning Lab
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.wdf.sap.corp/sap/machine-learning-lab" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    sap/machine-learning-lab
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="About ML Lab" class="md-nav__link">
      About ML Lab
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../getting-started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../walkthrough/lab-walkthrough/" title="ML Lab Walkthrough" class="md-nav__link">
      ML Lab Walkthrough
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../installation/install-lab/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Usage
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Usage
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../core-concepts/" title="Core Concepts" class="md-nav__link">
      Core Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab-workspace/" title="Workspace" class="md-nav__link">
      Workspace
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab-python-client/" title="ML Lab Python Client" class="md-nav__link">
      ML Lab Python Client
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab-api/" title="ML Lab REST API" class="md-nav__link">
      ML Lab REST API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../experiments-dashboard/" title="Experiments Dashboard" class="md-nav__link">
      Experiments Dashboard
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        How to create a Service
      </label>
    
    <a href="./" title="How to create a Service" class="md-nav__link md-nav__link--active">
      How to create a Service
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#minimum-requirements" class="md-nav__link">
    Minimum Requirements
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-configuration" class="md-nav__link">
    Default Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    Best Practices
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-services" class="md-nav__link">
    Example Services
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#service-deployment" class="md-nav__link">
    Service Deployment
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ml-lab" class="md-nav__link">
    ML Lab
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker-infrastructure" class="md-nav__link">
    Docker Infrastructure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-infrastructure" class="md-nav__link">
    Kubernetes Infrastructure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-service-via-workspace-image" class="md-nav__link">
    Run service via workspace image
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-code-from-version-control-system" class="md-nav__link">
    Run code from version control system
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-code-mounted-into-workspace" class="md-nav__link">
    Run code mounted into workspace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-code-from-ml-lab-data" class="md-nav__link">
    Run code from ML Lab data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-dependencies" class="md-nav__link">
    Install Dependencies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-service-in-interactive-mode" class="md-nav__link">
    Test service in interactive mode
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-a-custom-service-image" class="md-nav__link">
    Build a custom service image
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../how-to-create-a-job/" title="How to create a Job" class="md-nav__link">
      How to create a Job
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Administration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Administration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../administration/update-lab/" title="Update ML Lab" class="md-nav__link">
      Update ML Lab
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../administration/uninstall-lab/" title="Uninstall ML Lab" class="md-nav__link">
      Uninstall ML Lab
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../administration/manage-services/" title="Manage Services" class="md-nav__link">
      Manage Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../administration/backup-data/" title="Backup Data" class="md-nav__link">
      Backup Data
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Architecture
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Architecture
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../architecture/machine-learning-lifecycle/" title="ML Lifecycle" class="md-nav__link">
      ML Lifecycle
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../architecture/architecture/" title="ML Lab Architecture" class="md-nav__link">
      ML Lab Architecture
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../faq/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#minimum-requirements" class="md-nav__link">
    Minimum Requirements
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-configuration" class="md-nav__link">
    Default Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    Best Practices
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-services" class="md-nav__link">
    Example Services
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#service-deployment" class="md-nav__link">
    Service Deployment
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ml-lab" class="md-nav__link">
    ML Lab
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker-infrastructure" class="md-nav__link">
    Docker Infrastructure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-infrastructure" class="md-nav__link">
    Kubernetes Infrastructure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-service-via-workspace-image" class="md-nav__link">
    Run service via workspace image
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-code-from-version-control-system" class="md-nav__link">
    Run code from version control system
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-code-mounted-into-workspace" class="md-nav__link">
    Run code mounted into workspace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-code-from-ml-lab-data" class="md-nav__link">
    Run code from ML Lab data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-dependencies" class="md-nav__link">
    Install Dependencies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-service-in-interactive-mode" class="md-nav__link">
    Test service in interactive mode
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-a-custom-service-image" class="md-nav__link">
    Build a custom service image
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="how-to-create-a-service">How to create a Service<a class="headerlink" href="#how-to-create-a-service" title="Permanent link">&para;</a></h1>
<p>A service is a software component that implements and provides specific capabilities. Usually, a service provides REST APIs over HTTP(S) but can also provide other types of protocols that can be served through a TCP port. In the context of machine learning, a service is usually used to make trained models accessible for integration into applications.</p>
<p>If your goal is to deploy a model that was trained with a Python framework, the easiest way is to use the <a href="../unified-model-library">Unified Model Library</a>. If you want to build your own custom ML Lab compatible service, you are at least required to fulfill a small set of <a href="#minimum-requirements">minimum requirements</a>.</p>
<h2 id="minimum-requirements">Minimum Requirements<a class="headerlink" href="#minimum-requirements" title="Permanent link">&para;</a></h2>
<p>A service is required to be implemented as a <strong>Docker container</strong> that is expected to have at least one HTTP server exposed on any given port. Furthermore, we advise that the service image adheres <a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/">common docker standards</a> and <a href="#best-practices">best practices</a>.</p>
<div class="admonition info">
<p class="admonition-title">Expose Ports</p>
<p>All ports that need to be exposed are required to be mentioned via the <a href="https://docs.docker.com/engine/reference/builder/#expose"><code>EXPOSE</code> instruction</a> inside the Dockerfile.</p>
</div>
<p>Since we only require the service to be a Docker container, there are no technological restrictions on how the service is implemented (e.g. python/bash/java server). </p>
<p>A service deployed in an ML Lab project is only accessible from a <strong>relative path</strong> (as explained below) and requires a valid API token (via Authorization header, cookie, or get-parameter) to be accessed. You can get the API token in the user menu (top-right corner -&gt; <code>Get Project API Token</code>).</p>
<h3 id="default-configuration">Default Configuration<a class="headerlink" href="#default-configuration" title="Permanent link">&para;</a></h3>
<p>If a connection to an ML Lab instance is required, the service should make use of the following set of environment variables that are automatically passed to the service if started from within the web app:</p>
<table>
    <tr>
        <th>Variable</th>
        <th>Description</th>
        <th>Default</th>
    </tr>
    <tr>
        <td>LAB_ENDPOINT</td>
        <td>Endpoint URL of an ML Lab instance.</td>
        <td>(optional)</td>
    </tr>
    <tr>
        <td>LAB_API_TOKEN</td>
        <td>API Token to access the REST API of an ML Lab instance.</td>
        <td>(optional)</td>
    </tr>
    <tr>
        <td>LAB_PROJECT</td>
        <td>Specified project of an ML Lab Instance.</td>
        <td>(optional)</td>
    </tr>
    <tr>
        <td>LAB_SERVICE_PATH</td>
        <td>Base URL path to reach the service within ML Lab. The container internal port for the given endpoint needs to be added to this path as well.</td>
        <td>(optional)</td>
    </tr>
</table>

<p>The <a href="../lab-python-client">lab python client</a> and the lab java client will automatically use those environment variables to initialize a connection to ML Lab.</p>
<h3 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h3>
<p>We have a few best practices which we recommend to apply for developing your service:</p>
<ul>
<li>Always specify container parameters with default values directly inside the Dockerfile (<code>ENV EXAMPLE=example</code>)</li>
<li>Prefix internal environment variables that should not be changed with an underscore (<code>_RESOURCE_PATH</code>)</li>
<li>Use the <a href="https://docs.docker.com/engine/reference/builder/#expose"><code>EXPOSE</code> instruction</a> in the Dockerfile to make all required ports of your service available.</li>
<li>If the container has data that needs to be persisted put them int the <code>/data</code> folder (this is the default folder to be mounted).</li>
<li>If there is a way to check the health status of your service, implement the <a href="https://docs.docker.com/engine/reference/builder/#healthcheck"><code>HEALTHCHECK</code> instruction</a> in the Dockerfile.</li>
<li>Use default <code>stdout</code> for logging as explained in the <a href="https://docs.docker.com/config/containers/logging/">Docker documenation</a>.</li>
<li>If possible, use Ubuntu as base image.</li>
</ul>
<h3 id="example-services">Example Services<a class="headerlink" href="#example-services" title="Permanent link">&para;</a></h3>
<p>We prepared a few simple examples of valid Docker images for services with different Python web frameworks:</p>
<ul>
<li><a href="TODO">Fastapi Example</a>: <code>TODO</code></li>
<li><a href="TODO">Flask Example</a>: <code>TODO</code></li>
<li><a href="TODO">Flask-RESTPlus Example</a>: <code>TODO</code></li>
</ul>
<p>We recommend to use <a href="https://github.com/tiangolo/fastapi">Fastapi</a> for building your REST APIs.</p>
<h2 id="service-deployment">Service Deployment<a class="headerlink" href="#service-deployment" title="Permanent link">&para;</a></h2>
<p>To be able to deploy a service to ML Lab or any other Docker/Kubernetes infrastructure, the service image needs to be pushed to an accessible Docker registry such as <a href="https://hub.docker.com/">Docker Hub</a>.</p>
<h3 id="ml-lab">ML Lab<a class="headerlink" href="#ml-lab" title="Permanent link">&para;</a></h3>
<p>The easiest way to deploy a service in an ML Lab instance is via the Services UI by providing the service image and, optionally, a name and parameters (environment variables):</p>
<p><a href="../images/services-deploy-service-ui.png"><img alt="Deploy Service UI" src="../images/services-deploy-service-ui.png" /></a></p>
<p>As an alternative, you can also use the <code>POST /api/projects/{project}/services</code> REST API method of ML Lab to programmatically deploy a service.</p>
<p><a href="../images/services-deploy-service-api.png"><img alt="Deploy Service API" src="../images/services-deploy-service-api.png" /></a></p>
<p>Additionaly, you can also use the Python client to deploy a service to any ML Lab instance as shown below:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">lab_client</span> <span class="kn">import</span> <span class="n">Environment</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="s2">&quot;&lt;LAB_PROJECT&gt;&quot;</span><span class="p">,</span>
                  <span class="n">lab_endpoint</span><span class="o">=</span><span class="s2">&quot;&lt;LAB_ENDPOINT_URL&gt;&quot;</span><span class="p">,</span>
                  <span class="n">lab_api_token</span><span class="o">=</span><span class="s2">&quot;&lt;LAB_API_TOKEN&gt;&quot;</span>
                 <span class="p">)</span>

<span class="c1"># Deploy a Service</span>
<span class="n">env</span><span class="o">.</span><span class="n">lab_handler</span><span class="o">.</span><span class="n">lab_api</span><span class="o">.</span><span class="n">deploy_service</span><span class="p">(</span>
                  <span class="n">project</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">project</span><span class="p">,</span>
                  <span class="n">image</span><span class="o">=</span><span class="s2">&quot;&lt;YOUR_SERVICE_DOCKER_IMAGE&gt;&quot;</span><span class="p">,</span>
                  <span class="n">name</span><span class="o">=</span><span class="s2">&quot;my-service&quot;</span><span class="p">,</span>
                  <span class="c1"># Provide service configuration in request body</span>
                  <span class="n">body</span><span class="o">=</span> <span class="p">{</span>
                      <span class="s2">&quot;EXAMPLE_PARAMETER&quot;</span><span class="p">:</span> <span class="s2">&quot;example&quot;</span>
                  <span class="p">})</span>
</code></pre></div>

<p>Once the service is deployed, it is accessible from the following URL path: <code>/api/projects/&lt;PROJECT&gt;/services/&lt;SERVICE_NAME&gt;/&lt;PORT&gt;/</code>. This means that a service can only be used when it is deployed via ML Lab if it is able to serve its content from a relativ path. Furthermore, every so deployed service is secured. Therefore, a valid ML Lab API token is required to access the service via the mentioned URL. Please provide a valid user or project API token via the <code>Authorization</code> header in this format: <code>Bearer YOUR_API_TOKEN</code>. You can get your API token in the user menu (top-right corner) of Lab. As an alternative to the <code>Authorization</code> header, you can also provide the API token via cookie (<code>lab_access_token</code>) or via get paramter in the URL (<code>lab_token</code>).</p>
<div class="admonition info">
<p class="admonition-title">API token via URL parameter</p>
<p>Setting the API token via URL parameter will set the <code>lab_access_token</code> at the first request and, thereby, logs the user out, in case the user accessing the link is logged into the same ML Lab instance.</p>
</div>
<h3 id="docker-infrastructure">Docker Infrastructure<a class="headerlink" href="#docker-infrastructure" title="Permanent link">&para;</a></h3>
<p>Since the service is just a normal Docker container, you can run it on any Docker infrastructure via <a href="https://docs.docker.com/engine/reference/run/"><code>docker run</code></a> by exposing all marked ports via <code>-P</code>. Required parameters (configuration) can be provided via <code>--env</code>:</p>
<div class="highlight"><pre><span></span><code>docker run -d -P --env <span class="nv">EXAMPLE_PARAMETER</span><span class="o">=</span>example &lt;YOUR_SERVICE_DOCKER_IMAGE&gt;
</code></pre></div>

<h3 id="kubernetes-infrastructure">Kubernetes Infrastructure<a class="headerlink" href="#kubernetes-infrastructure" title="Permanent link">&para;</a></h3>
<p>For Kubernetes, please refer to <a href="https://kubernetes.io/docs/reference/kubectl/docker-cli-to-kubectl/">this guide</a>.</p>
<h2 id="run-service-via-workspace-image">Run service via workspace image<a class="headerlink" href="#run-service-via-workspace-image" title="Permanent link">&para;</a></h2>
<p>The workspace image can also be used to execute arbitrary Python code without starting any of the preinstalled tools. This provides a seamless way to productize your ML projects since the code that has been developed interactively within the workspace will have the same environment and configuration when run as a service via the same workspace image. To run Python code as a service, you need to provide a path or URL to a code directory (or script) via <code>EXECUTE_CODE</code>. The code can be either already mounted into the workspace container or downloaded from a version control system (e.g., git or svn) as described in the following sections. The selected code path needs to be python executable. In case the selected code is a directory (e.g., whenever you download the code from a VCS) you need to put a <code>__main__.py</code> file at the root of this directory. The <code>__main__.py</code> needs to contain the code that starts your service.</p>
<div class="admonition info">
<p class="admonition-title">Server on port 8091</p>
<p>The code is expected to start a server on port 8091, since a service requires a running HTTP server.</p>
</div>
<h3 id="run-code-from-version-control-system">Run code from version control system<a class="headerlink" href="#run-code-from-version-control-system" title="Permanent link">&para;</a></h3>
<p>You can execute code directly from Git, Mercurial, Subversion, or Bazaar by using the pip-vcs format as described in <a href="https://pip.pypa.io/en/stable/reference/pip_install/#vcs-support">this guide</a>. For example, to execute code from a <a href="https://github.com/ml-tooling/ml-workspace/tree/develop/docker-res/tests/ml-service">subdirectory</a> of a git repository, just run:</p>
<div class="highlight"><pre><span></span><code>docker run -p <span class="m">8091</span>:8091 --env <span class="nv">EXECUTE_CODE</span><span class="o">=</span><span class="s2">&quot;git+https://github.com/ml-tooling/ml-workspace.git#subdirectory=docker-res/tests/ml-service&quot;</span> mltooling/ml-workspace:latest
</code></pre></div>

<div class="admonition info">
<p class="admonition-title">Select branches, commits, or tags</p>
<p>For additional information on how to specify branches, commits, or tags please refer to <a href="https://pip.pypa.io/en/stable/reference/pip_install/#vcs-support">this guide</a>.</p>
</div>
<h3 id="run-code-mounted-into-workspace">Run code mounted into workspace<a class="headerlink" href="#run-code-mounted-into-workspace" title="Permanent link">&para;</a></h3>
<p>In the following example, we mount and execute the current working directory (expected to contain our code) into the <code>/workspace/ml-service/</code> directory of the workspace:</p>
<div class="highlight"><pre><span></span><code>docker run -p <span class="m">8091</span>:8091 -v <span class="s2">&quot;</span><span class="si">${</span><span class="nv">PWD</span><span class="si">}</span><span class="s2">:/workspace/ml-service/&quot;</span> --env <span class="nv">EXECUTE_CODE</span><span class="o">=</span><span class="s2">&quot;/workspace/ml-service/&quot;</span> mltooling/ml-workspace:latest
</code></pre></div>

<h3 id="run-code-from-ml-lab-data">Run code from ML Lab data<a class="headerlink" href="#run-code-from-ml-lab-data" title="Permanent link">&para;</a></h3>
<p>You can also run the service via data uploaded to ML Lab (single script or packaged code) by specifing the key via the <code>EXECUTE_CODE</code> variable.</p>
<h3 id="install-dependencies">Install Dependencies<a class="headerlink" href="#install-dependencies" title="Permanent link">&para;</a></h3>
<p>In the case that the preinstalled workspace libraries are not compatible with your code, you can install or change dependencies by just adding one or multiple of the following files to your code directory:</p>
<ul>
<li><code>requirements.txt</code>: <a href="https://pip.pypa.io/en/stable/user_guide/#requirements-files">pip requirements format</a> for pip-installable dependencies.</li>
<li><code>environment.yml</code>: <a href="https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html?highlight=environment.yml#creating-an-environment-file-manually">conda environment file</a> to create a separate Python environment.</li>
<li><code>setup.sh</code>: A shell script executed via <code>/bin/bash</code>.</li>
</ul>
<p>The execution order is 1. <code>environment.yml</code> -&gt; 2. <code>setup.sh</code> -&gt; 3. <code>requirements.txt</code></p>
<h3 id="test-service-in-interactive-mode">Test service in interactive mode<a class="headerlink" href="#test-service-in-interactive-mode" title="Permanent link">&para;</a></h3>
<p>You can test your service code within the workspace (started normally with interactive tools) by executing the following python script:</p>
<div class="highlight"><pre><span></span><code>python /resources/scripts/execute_code.py /path/to/your/service
</code></pre></div>

<h3 id="build-a-custom-service-image">Build a custom service image<a class="headerlink" href="#build-a-custom-service-image" title="Permanent link">&para;</a></h3>
<p>It is also possible to embed your code directly into a custom service image, as shown below:</p>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span> <span class="s">mltooling/ml-workspace:latest</span>

<span class="c"># Add service code to image</span>
<span class="k">COPY</span> ml-service /workspace/ml-service
<span class="k">ENV</span> <span class="nv">EXECUTE_CODE</span><span class="o">=</span>/workspace/ml-service

<span class="c"># Install requirements only</span>
<span class="k">RUN</span> python /resources/scripts/execute_code.py --requirements-only

<span class="c"># Execute only the code at container startup</span>
<span class="k">CMD</span> <span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">,</span> <span class="s2">&quot;/resources/docker-entrypoint.py&quot;</span><span class="p">,</span> <span class="s2">&quot;--code-only&quot;</span><span class="p">]</span>
</code></pre></div>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../experiments-dashboard/" title="Experiments Dashboard" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Experiments Dashboard
              </span>
            </div>
          </a>
        
        
          <a href="../how-to-create-a-job/" title="How to create a Job" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                How to create a Job
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/sap/machine-learning-lab" target="_blank" rel="noopener" title="github-alt" class="md-footer-social__link fa fa-github-alt"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
    
      <script src="../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.1.2",url:{base:"../.."}})</script>
      
    
    <script>

(function($) {
  // https://github.com/waylan/mkdocs-theme_dir-example
  "use strict";
  $.fn.sliderResponsive = function(settings) {
    
    var set = $.extend( 
      {
        slidePause: 5000,
        fadeSpeed: 800,
        autoPlay: "on",
        showArrows: "off", 
        hideDots: "off", 
        hoverZoom: "on",
        titleBarTop: "off"
      },
      settings
    ); 
    
    var $slider = $(this);
    var size = $slider.find("> div").length; //number of slides
    var position = 0; // current position of carousal
    var sliderIntervalID; // used to clear autoplay
      
    // Add a Dot for each slide
    $slider.append("<ul></ul>");
    $slider.find("> div").each(function(){
      $slider.find("> ul").append('<li></li>');
    });
      
    // Put .show on the first Slide
    $slider.find("div:first-of-type").addClass("show");
      
    // Put .showLi on the first dot
    $slider.find("li:first-of-type").addClass("showli")

     //fadeout all items except .show
    $slider.find("> div").not(".show").fadeOut();
    
    // If Autoplay is set to 'on' than start it
    if (set.autoPlay === "on") {
        startSlider(); 
    } 
    
    // If showarrows is set to 'on' then don't hide them
    if (set.showArrows === "on") {
        $slider.addClass('showArrows'); 
    }
    
    // If hideDots is set to 'on' then hide them
    if (set.hideDots === "on") {
        $slider.addClass('hideDots'); 
    }
    
    // If hoverZoom is set to 'off' then stop it
    if (set.hoverZoom === "off") {
        $slider.addClass('hoverZoomOff'); 
    }
    
    // If titleBarTop is set to 'on' then move it up
    if (set.titleBarTop === "on") {
        $slider.addClass('titleBarTop'); 
    }

    // function to start auto play
    function startSlider() {
      sliderIntervalID = setInterval(function() {
        nextSlide();
      }, set.slidePause);
    }
    
    // on mouseover stop the autoplay
    $slider.mouseover(function() {
      if (set.autoPlay === "on") {
        clearInterval(sliderIntervalID);
      }
    });
      
    // on mouseout starts the autoplay
    $slider.mouseout(function() {
      if (set.autoPlay === "on") {
        startSlider();
      }
    });

    //on right arrow click
    $slider.find("> .right").click(nextSlide)

    //on left arrow click
    $slider.find("> .left").click(prevSlide);
      
    // Go to next slide
    function nextSlide() {
      position = $slider.find(".show").index() + 1;
      if (position > size - 1) position = 0;
      changeCarousel(position);
    }
    
    // Go to previous slide
    function prevSlide() {
      position = $slider.find(".show").index() - 1;
      if (position < 0) position = size - 1;
      changeCarousel(position);
    }

    //when user clicks slider button
    $slider.find(" > ul > li").click(function() {
      position = $(this).index();
      changeCarousel($(this).index());
    });

    //this changes the image and button selection
    function changeCarousel() {
      $slider.find(".show").removeClass("show").fadeOut();
      $slider
        .find("> div")
        .eq(position)
        .fadeIn(set.fadeSpeed)
        .addClass("show");
      // The Dots
      $slider.find("> ul").find(".showli").removeClass("showli");
      $slider.find("> ul > li").eq(position).addClass("showli");
    }

    return $slider;
  };
})(jQuery);


 
//////////////////////////////////////////////
// Activate each slider - change options
//////////////////////////////////////////////
$(document).ready(function() {
  
  $("#slider1").sliderResponsive({
    slidePause: 7000,
    fadeSpeed: 400,
    autoPlay: "on",
    showArrows: "off", 
    hideDots: "on", 
    hoverZoom: "off", 
    titleBarTop: "off"
  });
}); 



    </script>

  </body>
</html>