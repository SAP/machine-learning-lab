



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for the Machine Learning Lab">
      
      
        <link rel="canonical" href="https://sap.github.io/machine-learning-lab/usage/how-to-create-a-job/">
      
      
        <meta name="author" content="Lukas Masuch & Benjamin Räthlein">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.1, mkdocs-material-4.6.3">
    
    
      
        <title>How to create a Job - Machine Learning Lab</title>
      
    
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.adb8469c.css">
      
      
    
    <link rel="stylesheet" href="../../css/image-slider.css">

    
    
      <script src="../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../css/mllab.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#how-to-create-a-job" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://sap.github.io/machine-learning-lab/" title="Machine Learning Lab" aria-label="Machine Learning Lab" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Machine Learning Lab
            </span>
            <span class="md-header-nav__topic">
              
                How to create a Job
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/sap/machine-learning-lab" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    sap/machine-learning-lab
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://sap.github.io/machine-learning-lab/" title="Machine Learning Lab" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Machine Learning Lab
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/sap/machine-learning-lab" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    sap/machine-learning-lab
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="About ML Lab" class="md-nav__link">
      About ML Lab
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../getting-started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../walkthrough/lab-walkthrough/" title="ML Lab Walkthrough" class="md-nav__link">
      ML Lab Walkthrough
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../installation/install-lab/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Usage
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Usage
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../core-concepts/" title="Core Concepts" class="md-nav__link">
      Core Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab-workspace/" title="Workspace" class="md-nav__link">
      Workspace
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab-python-client/" title="ML Lab Python Client" class="md-nav__link">
      ML Lab Python Client
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab-api/" title="ML Lab REST API" class="md-nav__link">
      ML Lab REST API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../experiments-dashboard/" title="Experiments Dashboard" class="md-nav__link">
      Experiments Dashboard
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../how-to-create-a-service/" title="How to create a Service" class="md-nav__link">
      How to create a Service
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        How to create a Job
      </label>
    
    <a href="./" title="How to create a Job" class="md-nav__link md-nav__link--active">
      How to create a Job
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#minimum-requirements" class="md-nav__link">
    Minimum Requirements
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-configuration" class="md-nav__link">
    Default Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    Best Practices
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-deployment" class="md-nav__link">
    Job Deployment
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ml-lab" class="md-nav__link">
    ML Lab
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker-infrastructure" class="md-nav__link">
    Docker Infrastructure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-infrastructure" class="md-nav__link">
    Kubernetes Infrastructure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-job-via-workspace-image" class="md-nav__link">
    Run job via workspace image
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-code-from-version-control-system" class="md-nav__link">
    Run code from version control system
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-code-mounted-into-workspace" class="md-nav__link">
    Run code mounted into workspace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-code-from-lab-data" class="md-nav__link">
    Run code from Lab data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-dependencies" class="md-nav__link">
    Install Dependencies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-job-in-interactive-mode" class="md-nav__link">
    Test job in interactive mode
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-a-custom-job-image" class="md-nav__link">
    Build a custom job image
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Administration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Administration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../administration/update-lab/" title="Update ML Lab" class="md-nav__link">
      Update ML Lab
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../administration/uninstall-lab/" title="Uninstall ML Lab" class="md-nav__link">
      Uninstall ML Lab
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../administration/manage-services/" title="Manage Services" class="md-nav__link">
      Manage Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../administration/backup-data/" title="Backup Data" class="md-nav__link">
      Backup Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../administration/external-oidc-authentication/" title="External OIDC Authentication" class="md-nav__link">
      External OIDC Authentication
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Architecture
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Architecture
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../architecture/machine-learning-lifecycle/" title="ML Lifecycle" class="md-nav__link">
      ML Lifecycle
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../architecture/architecture/" title="ML Lab Architecture" class="md-nav__link">
      ML Lab Architecture
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../faq/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#minimum-requirements" class="md-nav__link">
    Minimum Requirements
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-configuration" class="md-nav__link">
    Default Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    Best Practices
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-deployment" class="md-nav__link">
    Job Deployment
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ml-lab" class="md-nav__link">
    ML Lab
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker-infrastructure" class="md-nav__link">
    Docker Infrastructure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-infrastructure" class="md-nav__link">
    Kubernetes Infrastructure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-job-via-workspace-image" class="md-nav__link">
    Run job via workspace image
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-code-from-version-control-system" class="md-nav__link">
    Run code from version control system
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-code-mounted-into-workspace" class="md-nav__link">
    Run code mounted into workspace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-code-from-lab-data" class="md-nav__link">
    Run code from Lab data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-dependencies" class="md-nav__link">
    Install Dependencies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-job-in-interactive-mode" class="md-nav__link">
    Test job in interactive mode
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-a-custom-job-image" class="md-nav__link">
    Build a custom job image
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/sap/machine-learning-lab/edit/master/docs/usage/how-to-create-a-job.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="how-to-create-a-job">How to create a Job<a class="headerlink" href="#how-to-create-a-job" title="Permanent link">&para;</a></h1>
<p>A job is a software component that runs a finite task for a certain time to completion. Jobs are useful for running experiments, such as model training and data pipelines, or other kinds of large computations and batch-oriented tasks. We suggest migrating data processing or model training scripts from the workspace into jobs, once the scripts are ready for production usage. This makes it simple to rerun and schedule your production-ready data pipelines and model trainings.</p>
<h2 id="minimum-requirements">Minimum Requirements<a class="headerlink" href="#minimum-requirements" title="Permanent link">&para;</a></h2>
<p>A job is required to be implemented as a <strong>Docker container</strong> that is expected to run a finite task that returns a successful or failed exit code after completion. Furthermore, we advise that the job image adheres <a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/">common docker standards</a> and <a href="#best-practices">best practices</a>.</p>
<div class="admonition info">
<p class="admonition-title">Status Codes</p>
<p>Your job should return the right status code once it is finished. A status code of <strong>0 means the job succeeded</strong>. A status code different to 0 means, the job failed.</p>
</div>
<p>Since we only require the job to be a Docker container, there are no technological restrictions on how the task is implemented (e.g. python/bash/java script).</p>
<h3 id="default-configuration">Default Configuration<a class="headerlink" href="#default-configuration" title="Permanent link">&para;</a></h3>
<p>If a connection to an ML Lab instance is required, the job should make use of the following set of environment variables that are automatically passed to the job if started from ML Lab:</p>
<table>
    <tr>
        <th>Variable</th>
        <th>Description</th>
        <th>Default</th>
    </tr>
    <tr>
        <td>LAB_ENDPOINT</td>
        <td>Endpoint URL of an ML Lab instance.</td>
        <td>(optional)</td>
    </tr>
    <tr>
        <td>LAB_API_TOKEN</td>
        <td>API Token to access the REST API of an ML Lab instance.</td>
        <td>(optional)</td>
    </tr>
    <tr>
        <td>LAB_PROJECT</td>
        <td>Specified project of an ML Lab Instance.</td>
        <td>(optional)</td>
    </tr>
</table>

<p>The <a href="../lab-python-client">lab python client</a> and the <a href="../how-to-create-a-service/#environment">lab java client</a> will automatically use those environment variables to initialize a connection to Lab.</p>
<h3 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h3>
<p>We have a few best practices which we recommend to apply for developing your jobs:</p>
<ul>
<li>Always specify container parameters with default values directly inside the Dockerfile (<code>ENV EXAMPLE=example</code>)</li>
<li>Prefix internal environment variables that should not be changed with an underscore (<code>_RESOURCE_PATH</code>)</li>
<li>If the container has data that needs to be persisted put them int the <code>/data</code> folder (this is the default folder to be mounted).</li>
<li>Use default <code>stdout</code> for logging as explained in the <a href="https://docs.docker.com/config/containers/logging/">Docker documenation</a>.</li>
<li>If possible, use Ubuntu as base image.</li>
</ul>
<h2 id="job-deployment">Job Deployment<a class="headerlink" href="#job-deployment" title="Permanent link">&para;</a></h2>
<p>To be able to deploy a job to Lab or any other Docker/Kubernetes infrastructure, the job image needs to be pushed to an accessible Docker registry such as <a href="https://hub.docker.com/">Docker Hub</a>.</p>
<h3 id="ml-lab">ML Lab<a class="headerlink" href="#ml-lab" title="Permanent link">&para;</a></h3>
<p>The easiest way to run a job in an ML Lab instance is via the Jobs UI by providing the job image and, optionally, a name and parameters (environment variables):</p>
<p><a href="../images/jobs-deploy-job-ui.png"><img alt="Deploy Job UI" src="../images/jobs-deploy-job-ui.png" /></a></p>
<p>Besides single-run execution, a job can also be scheduled using the <a href="http://www.adminschoice.com/crontab-quick-reference">UNIX CRON definition</a>. A scheduled job will run at approximately the given time, with a possible delay of seconds/minutes.</p>
<p>As an alternative, you can also use the <code>POST /lab/projects/{project}/jobs</code> REST API method of Lab to programmatically run or schedule a job.</p>
<p><a href="../images/jobs-deploy-job-api.png"><img alt="Deploy Job API" src="../images/jobs-deploy-job-api.png" /></a></p>
<p>Additionaly, you can also use the Python client to deploy a job to any Lab instance as shown below:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">lab_client</span> <span class="kn">import</span> <span class="n">Environment</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="s2">&quot;&lt;LAB_PROJECT&gt;&quot;</span><span class="p">,</span>
                  <span class="n">lab_endpoint</span><span class="o">=</span><span class="s2">&quot;&lt;LAB_ENDPOINT_URL&gt;&quot;</span><span class="p">,</span>
                  <span class="n">lab_api_token</span><span class="o">=</span><span class="s2">&quot;&lt;LAB_API_TOKEN&gt;&quot;</span>
                 <span class="p">)</span>

<span class="kn">from</span> <span class="nn">lab_client.handler.lab_job_handler</span> <span class="kn">import</span> <span class="n">LabJobConfig</span><span class="p">,</span> <span class="n">LabJobHandler</span>
<span class="n">job_handler</span> <span class="o">=</span> <span class="n">LabJobHandler</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>

<span class="c1"># Configure the job</span>
<span class="n">demo_job</span> <span class="o">=</span> <span class="n">LabJobConfig</span><span class="p">(</span>
    <span class="n">image</span><span class="o">=</span><span class="s2">&quot;&lt;YOUR_JOB_DOCKER_IMAGE&gt;&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;my-job&quot;</span><span class="p">,</span>
    <span class="n">params</span><span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;EXAMPLE_PARAMETER&quot;</span><span class="p">:</span> <span class="s2">&quot;example&quot;</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Run the job. To run the job in background, set check_status to False.</span>
<span class="n">job_handler</span><span class="o">.</span><span class="n">run_job</span><span class="p">(</span><span class="n">demo_job</span><span class="p">,</span> <span class="n">check_status</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<h3 id="docker-infrastructure">Docker Infrastructure<a class="headerlink" href="#docker-infrastructure" title="Permanent link">&para;</a></h3>
<p>Since the job is just a normal Docker container, you can run it on any Docker infrastructure via <a href="https://docs.docker.com/engine/reference/run/"><code>docker run</code></a> and provide the required parameters via <code>--env</code>:</p>
<div class="highlight"><pre><span></span><code>docker run -d --env <span class="nv">EXAMPLE_PARAMETER</span><span class="o">=</span>example &lt;YOUR_JOB_DOCKER_IMAGE&gt;
</code></pre></div>
<h3 id="kubernetes-infrastructure">Kubernetes Infrastructure<a class="headerlink" href="#kubernetes-infrastructure" title="Permanent link">&para;</a></h3>
<p>For Kubernetes, please refer to <a href="https://kubernetes.io/docs/reference/kubectl/docker-cli-to-kubectl/">this guide</a>.</p>
<h2 id="run-job-via-workspace-image">Run job via workspace image<a class="headerlink" href="#run-job-via-workspace-image" title="Permanent link">&para;</a></h2>
<p>The workspace image can also be used to execute arbitrary Python code without starting any of the preinstalled tools. This provides a seamless way to productize your ML projects since the code that has been developed interactively within the workspace will have the same environment and configuration when run as a job via the same workspace image. To run Python code as a job, you need to provide a path or URL to a code directory (or script) via <code>EXECUTE_CODE</code>. The code can be either already mounted into the workspace container or downloaded from a version control system (e.g., git or svn) as described in the following sections. The selected code path needs to be python executable. In case the selected code is a directory (e.g., whenever you download the code from a VCS) you need to put a <code>__main__.py</code> file at the root of this directory. The <code>__main__.py</code> needs to contain the code that starts your job.</p>
<h3 id="run-code-from-version-control-system">Run code from version control system<a class="headerlink" href="#run-code-from-version-control-system" title="Permanent link">&para;</a></h3>
<p>You can execute code directly from Git, Mercurial, Subversion, or Bazaar by using the pip-vcs format as described in <a href="https://pip.pypa.io/en/stable/reference/pip_install/#vcs-support">this guide</a>. For example, to execute code from a <a href="https://github.com/ml-tooling/ml-workspace/tree/develop/docker-res/tests/ml-job">subdirectory</a> of a git repository, just run:</p>
<div class="highlight"><pre><span></span><code>docker run --env <span class="nv">EXECUTE_CODE</span><span class="o">=</span><span class="s2">&quot;git+https://github.com/ml-tooling/ml-workspace.git#subdirectory=docker-res/tests/ml-job&quot;</span> mltooling/ml-workspace:latest
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Select branches, commits, or tags</p>
<p>For additional information on how to specify branches, commits, or tags please refer to <a href="https://pip.pypa.io/en/stable/reference/pip_install/#vcs-support">this guide</a>.</p>
</div>
<h3 id="run-code-mounted-into-workspace">Run code mounted into workspace<a class="headerlink" href="#run-code-mounted-into-workspace" title="Permanent link">&para;</a></h3>
<p>In the following example, we mount and execute the current working directory (expected to contain our code) into the <code>/workspace/ml-job/</code> directory of the workspace:</p>
<div class="highlight"><pre><span></span><code>docker run -v <span class="s2">&quot;</span><span class="si">${</span><span class="nv">PWD</span><span class="si">}</span><span class="s2">:/workspace/ml-job/&quot;</span> --env <span class="nv">EXECUTE_CODE</span><span class="o">=</span><span class="s2">&quot;/workspace/ml-job/&quot;</span> mltooling/ml-workspace:latest
</code></pre></div>
<h3 id="run-code-from-lab-data">Run code from Lab data<a class="headerlink" href="#run-code-from-lab-data" title="Permanent link">&para;</a></h3>
<p>You can also run the job via data uploaded to Lab (single script or packaged code) by specifing the key via the <code>EXECUTE_CODE</code> variable.</p>
<h3 id="install-dependencies">Install Dependencies<a class="headerlink" href="#install-dependencies" title="Permanent link">&para;</a></h3>
<p>In the case that the preinstalled workspace libraries are not compatible with your code, you can install or change dependencies by just adding one or multiple of the following files to your code directory:</p>
<ul>
<li><code>requirements.txt</code>: <a href="https://pip.pypa.io/en/stable/user_guide/#requirements-files">pip requirements format</a> for pip-installable dependencies.</li>
<li><code>environment.yml</code>: <a href="https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html?highlight=environment.yml#creating-an-environment-file-manually">conda environment file</a> to create a separate Python environment.</li>
<li><code>setup.sh</code>: A shell script executed via <code>/bin/bash</code>.</li>
</ul>
<p>The execution order is 1. <code>environment.yml</code> -&gt; 2. <code>setup.sh</code> -&gt; 3. <code>requirements.txt</code></p>
<h3 id="test-job-in-interactive-mode">Test job in interactive mode<a class="headerlink" href="#test-job-in-interactive-mode" title="Permanent link">&para;</a></h3>
<p>You can test your job code within the workspace (started normally with interactive tools) by executing the following python script:</p>
<div class="highlight"><pre><span></span><code>python /resources/scripts/execute_code.py /path/to/your/job
</code></pre></div>
<h3 id="build-a-custom-job-image">Build a custom job image<a class="headerlink" href="#build-a-custom-job-image" title="Permanent link">&para;</a></h3>
<p>It is also possible to embed your code directly into a custom job image, as shown below:</p>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">mltooling/ml-workspace:latest</span>

<span class="c"># Add job code to image</span>
<span class="k">COPY</span><span class="w"> </span>ml-job /workspace/ml-job
<span class="k">ENV</span><span class="w"> </span><span class="nv">EXECUTE_CODE</span><span class="o">=</span>/workspace/ml-job

<span class="c"># Install requirements only</span>
<span class="k">RUN</span><span class="w"> </span>python /resources/scripts/execute_code.py --requirements-only

<span class="c"># Execute only the code at container startup</span>
<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;/resources/docker-entrypoint.py&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;--code-only&quot;</span><span class="p">]</span>
</code></pre></div>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../how-to-create-a-service/" title="How to create a Service" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                How to create a Service
              </span>
            </div>
          </a>
        
        
          <a href="../../administration/update-lab/" title="Update ML Lab" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Update ML Lab
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/sap/machine-learning-lab" target="_blank" rel="noopener" title="github-alt" class="md-footer-social__link fa fa-github-alt"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
    
      <script src="../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.4.1",url:{base:"../.."}})</script>
      
    
    <script>

(function($) {
  // https://github.com/waylan/mkdocs-theme_dir-example
  "use strict";
  $.fn.sliderResponsive = function(settings) {
    
    var set = $.extend( 
      {
        slidePause: 5000,
        fadeSpeed: 800,
        autoPlay: "on",
        showArrows: "off", 
        hideDots: "off", 
        hoverZoom: "on",
        titleBarTop: "off"
      },
      settings
    ); 
    
    var $slider = $(this);
    var size = $slider.find("> div").length; //number of slides
    var position = 0; // current position of carousal
    var sliderIntervalID; // used to clear autoplay
      
    // Add a Dot for each slide
    $slider.append("<ul></ul>");
    $slider.find("> div").each(function(){
      $slider.find("> ul").append('<li></li>');
    });
      
    // Put .show on the first Slide
    $slider.find("div:first-of-type").addClass("show");
      
    // Put .showLi on the first dot
    $slider.find("li:first-of-type").addClass("showli")

     //fadeout all items except .show
    $slider.find("> div").not(".show").fadeOut();
    
    // If Autoplay is set to 'on' than start it
    if (set.autoPlay === "on") {
        startSlider(); 
    } 
    
    // If showarrows is set to 'on' then don't hide them
    if (set.showArrows === "on") {
        $slider.addClass('showArrows'); 
    }
    
    // If hideDots is set to 'on' then hide them
    if (set.hideDots === "on") {
        $slider.addClass('hideDots'); 
    }
    
    // If hoverZoom is set to 'off' then stop it
    if (set.hoverZoom === "off") {
        $slider.addClass('hoverZoomOff'); 
    }
    
    // If titleBarTop is set to 'on' then move it up
    if (set.titleBarTop === "on") {
        $slider.addClass('titleBarTop'); 
    }

    // function to start auto play
    function startSlider() {
      sliderIntervalID = setInterval(function() {
        nextSlide();
      }, set.slidePause);
    }
    
    // on mouseover stop the autoplay
    $slider.mouseover(function() {
      if (set.autoPlay === "on") {
        clearInterval(sliderIntervalID);
      }
    });
      
    // on mouseout starts the autoplay
    $slider.mouseout(function() {
      if (set.autoPlay === "on") {
        startSlider();
      }
    });

    //on right arrow click
    $slider.find("> .right").click(nextSlide)

    //on left arrow click
    $slider.find("> .left").click(prevSlide);
      
    // Go to next slide
    function nextSlide() {
      position = $slider.find(".show").index() + 1;
      if (position > size - 1) position = 0;
      changeCarousel(position);
    }
    
    // Go to previous slide
    function prevSlide() {
      position = $slider.find(".show").index() - 1;
      if (position < 0) position = size - 1;
      changeCarousel(position);
    }

    //when user clicks slider button
    $slider.find(" > ul > li").click(function() {
      position = $(this).index();
      changeCarousel($(this).index());
    });

    //this changes the image and button selection
    function changeCarousel() {
      $slider.find(".show").removeClass("show").fadeOut();
      $slider
        .find("> div")
        .eq(position)
        .fadeIn(set.fadeSpeed)
        .addClass("show");
      // The Dots
      $slider.find("> ul").find(".showli").removeClass("showli");
      $slider.find("> ul > li").eq(position).addClass("showli");
    }

    return $slider;
  };
})(jQuery);


 
//////////////////////////////////////////////
// Activate each slider - change options
//////////////////////////////////////////////
$(document).ready(function() {
  
  $("#slider1").sliderResponsive({
    slidePause: 7000,
    fadeSpeed: 400,
    autoPlay: "on",
    showArrows: "off", 
    hideDots: "on", 
    hoverZoom: "off", 
    titleBarTop: "off"
  });
}); 



    </script>

  </body>
</html>